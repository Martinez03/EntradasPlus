{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="text-center mt-3">{{ grupo.nombre }}</h2>
    <p>{{ grupo.descripcion }}</p>
    
    {% if user in grupo.usuarios.all %}
        <!-- Mensajes del grupo -->
        <div id="grupo-mensajes" class="border p-3 rounded mb-3" style="height: 400px; overflow-y: auto;">
            {% for mensaje in mensajes %}
                <div class="mb-2">
                    <strong>{{ mensaje.usuario.username }}:</strong>
                    <span>{{ mensaje.contenido }}</span>
                    <small class="text-muted">{{ mensaje.fecha_creacion|date:"H:i d/m/Y" }}</small>
                    {% if user == grupo.admin %}
                        <a href="{% url 'eliminar_mensaje_grupo' mensaje.id %}">Eliminar</a>
                    {% endif %}
                </div>
            {% empty %}
                <p class="text-muted text-center">No hay mensajes en este grupo.</p>
            {% endfor %}
        </div>

        <!-- Formulario para enviar mensajes -->
        <form method="POST" class="mt-3">
            {% csrf_token %}
            <div class="input-group">
                <textarea name="contenido" class="form-control" rows="2" placeholder="Escribe un mensaje..."></textarea>
                <button type="submit" class="btn btn-grad ms-2">Enviar</button>
            </div>
        </form>
    {% elif grupo.tipo == 'publico' %}
        <a href="{% url 'unirse_grupo' grupo.id %}" class="btn btn-grad">Unirse al Grupo</a>
    {% else %}
        <form method="POST" action="{% url 'solicitar_union_grupo' grupo.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-grad">Solicitar Uni√≥n</button>
        </form>
    {% endif %}
</div>
{% endblock %}
